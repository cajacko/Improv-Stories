function takeTurn(){$(document).ready(function(){$("button#storyAction").click(function(){$.ajax({url:"/next-story",dataType:"json"}).done(function(t){console.log(t),$("body").addClass("editMode"),playLastStory(t)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})})})}function playLastStory(t){$("#story").append('<div id="lastEntry"></div>');var n=0,e=setInterval(function(){if(t.length>n){var o=t[n];$("#lastEntry").html(o),n++}else clearInterval(e),$("#lastEntry").attr("id",""),startWriting()},75)}function startWriting(){$("#story").append('<div id="currentEntry"></div>'),setTimer(),$("html").on("click.storyFocus",function(){$("#contentEditText").focus()}),$("#contentEditText").html("").prop("disabled",!1).focus(),$("#contentEditText").on("keydown",function(t){timeOn&&!contains.call(disabledKeys,t.keyCode)||t.preventDefault()}).bind("paste",function(t){t.preventDefault()}).on("keyup",function(){if(timeOn){var t=$(this).val();addToStory(t);var n=story[story.length-1].content;n=n.replace(/(?:\r\n|\r|\n)/g,"<br><br>"),$("#currentEntry").html(n)}})}function addToStory(t){var n=new Date;story.push({time:n.getTime(),content:t})}function setTimer(){clearInterval(interval);var t=10,n=timeout;timeOn=!0,interval=setInterval(function(){if(n-=t,0>=n)timeOn=!1,$("#contentEditText").blur().prop("disabled",!0),$("html").off(".storyFocus"),setTimeout(function(){clearInterval(interval)},t);else{var e=n/1e3;e=parseFloat(Math.round(100*e)/100).toFixed(2),e+="s",console.log(e)}},t)}takeTurn();var timer,interval,playStory,timeout=2e4,timeOn=!1,story=[],contains=function(t){var n,e=t!==t;return n=e||"function"!=typeof Array.prototype.indexOf?function(t){var n=-1,o=-1;for(n=0;n<this.length;n++){var r=this[n];if(e&&r!==r||r===t){o=n;break}}return o}:Array.prototype.indexOf,n.call(this,t)>-1},disabledKeys=[40,38,39,37,9];