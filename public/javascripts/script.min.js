function takeTurn(){$(document).ready(function(){$("button#storyAction").click(function(){$.ajax({url:"/next-story",dataType:"json"}).done(function(t){$("#storyAction").after('<span id="temp">Last entry from Charlie</span>').remove(),$("#temp").attr("id","storyAction"),$("body").addClass("editMode"),playLastStory(t)}).fail(function(){})})})}function playLastStory(t){scrollToBottom(function(){$("#story").append('<div id="lastEntry"></div>'),setTimeout(function(){var n=0,e=setInterval(function(){if(t.length>n){var o=t[n].content;$("#lastEntry").html(o),n++}else clearInterval(e),$("#lastEntry").attr("id",""),startWriting()},75)},500)})}function startWriting(){$("#story").append('<div id="currentEntry"></div>'),setTimer(),$("article").on("click.storyFocus",function(){$("#contentEditText").focus()}),$("#contentEditText").html("").prop("disabled",!1).focus(),$("#contentEditText").is(":focus")||$("#storyAction").prepend("<div>Touch the screen to start</div>"),$("#contentEditText").on("keydown",function(t){timeOn&&!contains.call(disabledKeys,t.keyCode)||t.preventDefault()}).bind("paste",function(t){t.preventDefault()}).on("keyup",function(){if(timeOn){var t=$(this).val();addToStory(t);var n=story[story.length-1].content;n=n.replace(/(?:\r\n|\r|\n)/g,"<br><br>"),$("#currentEntry").html(n)}})}function addToStory(t){var n=new Date;story.push({time:n.getTime(),content:t})}function setTimer(){clearInterval(interval);var t=10,n=timeout;timeOn=!0,$("#storyAction").html('Start writing, you have <span id="time">'+timeout/1e3+"</span>s left!"),interval=setInterval(function(){if(n-=t,0>=n)$("#storyAction").text("Done"),timeOn=!1,$("#contentEditText").blur().prop("disabled",!0),$("body").removeClass("editMode"),$("html").off(".storyFocus"),clearInterval(interval),saveEntry(story);else{var e=n/1e3;e=parseFloat(Math.round(100*e)/100).toFixed(2),$("#time").text(e)}},t)}function saveEntry(t){t=JSON.stringify(t),$.ajax({url:"/save-entry",type:"POST",dataType:"json",data:{story:t,action:"saveEntry",storyId:15}}).done(function(t){location.reload(!0)}).fail(function(){})}function scrollToBottom(t){$("main").animate({scrollTop:$("#mainWrap").outerHeight()},"slow",t())}takeTurn();var timer,interval,playStory,timeout=1e4,timeOn=!1,story=[],contains=function(t){var n,e=t!==t;return n=e||"function"!=typeof Array.prototype.indexOf?function(t){var n=-1,o=-1;for(n=0;n<this.length;n++){var r=this[n];if(e&&r!==r||r===t){o=n;break}}return o}:Array.prototype.indexOf,n.call(this,t)>-1},disabledKeys=[40,38,39,37,9];